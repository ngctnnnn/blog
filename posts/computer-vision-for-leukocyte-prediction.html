<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Leukocyte classification to predict diseases (Part 1) | A technical blog</title>
    <meta name="description" content="The official blog">
    <link rel="stylesheet" href="/assets/style.a95e0a9f.css">
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <meta name="twitter:title" content="Leukocyte classification to predict diseases (Part 1) | A technical blog">
    <meta property="og:title" content="Leukocyte classification to predict diseases (Part 1) | A technical blog">
  </head>
  <body>
    <div id="app"><div class="antialiased"><div class="flex bg-white"><nav class="z-50 fixed w-full flex justify-center py-3 font-bold bg-white border border-fuchsia-600"><div class="w-full flex justify-between px-4 sm:px-6 xl:max-w-5xl xl:px-0"><a class="text-xl" href="/" aria-label="A technical blog"><img class="inline-block mr-2 spin-img" style="width:36px;height:31px;" alt="logo" src="/logo.png"><span class="hidden md:inline nav-text">A technical blog</span></a><div class="text-base text-gray-500 leading-5 space-x-6"><a class="hover:text-gray-700 text-xl" href="https://github.com/ngctnnnn/ngctnnnn.github.io" target="_blank" rel="noopener">About us</a></div></div></nav></div><main class="max-w-3xl mx-auto px-4 sm:px-6 xl:max-w-5xl xl:px-0 mt-14"><article class="xl:divide-y xl:divide-gray-200"><header class="pt-6 xl:pb-10 space-y-1 text-center"><dl><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-500"><time datetime="2021-09-22T12:00:00.000Z">September 22, 2021</time></dd></dl><h1 class="text-3xl leading-9 font-extrabold text-gray-900 tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Leukocyte classification to predict diseases (Part 1)</h1></header><div class="divide-y xl:divide-y-0 divide-gray-200 xl:grid xl:grid-cols-4 xl:gap-x-10 pb-16 xl:pb-20" style="grid-template-rows:auto 1fr;"><dl class="pt-6 pb-10 xl:pt-11 xl:border-b xl:border-gray-200"><dt class="sr-only">Authors</dt><dd><ul class="flex justify-center xl:block space-x-8 sm:space-x-12 xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="https://gravatar.com/avatar/6c1ae5231dcadf6b4297a6ddf6315478?s=80" alt="author image" class="w-10 h-10 rounded-full"><dl class="text-sm font-medium leading-5 whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900">Tan Ngoc Pham</dd><dt class="sr-only">Linkedin</dt><dd><a href="https://linkedin.com/in/ngctnnnn" target="_blank" rel="noopnener noreferrer" class="link">@ngctnnnn</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 xl:pb-0 xl:col-span-3 xl:row-span-2"><div style="position:relative;" class="prose max-w-none pt-10 pb-8"><div><p>Data analysis on number of blood cells, which are white blood cells and red blood cells, per a certain blood volume could help us observe our medical situation. In this blog, we introduce a faster method to recognize disease via the number of leukocytes.</p><hr><p>Since this blog is rather long, we divide it into 2 parts, the first one is to introduce our approach to the problem, our dataset and our approach to preprocess data, then the second one is to discuss further about how to identify our needed cells in the preprocessed data through Canny object detection and Hough transformation.</p><h4 id="table-of-contents" tabindex="-1">Table of contents <a class="header-anchor" href="#table-of-contents" aria-hidden="true">#</a></h4><ul><li><a href="https://ngctnnnn.github.io/posts/computer-vision-for-leukocyte-prediction.html" target="_blank" rel="noopener noreferrer">Part 1</a><ul><li><ol><li><a href="#:~:text=1.%20Introduction">Introduction</a></li></ol></li><li><ol start="2"><li><a href="#:~:text=2.%20Dataset%20and%20data%20preprocessing">Dataset and data preprocessing</a></li></ol></li><li><ol start="3"><li><a href="#:~:text=3.%20Foreground%20and%20background%20segmentation%20technique">Foreground and background segmentation technique</a></li></ol></li></ul></li><li><a href="https://ngctnnnn.github.io/posts/computer-vision-for-leukocyte-prediction-2.html" target="_blank" rel="noopener noreferrer">Part 2</a><ul><li><ol start="4"><li><a href="https://ngctnnnn.github.io/posts/computer-vision-for-leukocyte-prediction-2.html#:~:text=4.%20Edge%20detection%20with%20Canny%20method" target="_blank" rel="noopener noreferrer">Edge detection with Canny method</a></li></ol></li><li><ol start="5"><li><a href="https://ngctnnnn.github.io/posts/computer-vision-for-leukocyte-prediction-2.html#:~:text=5.%20Hough%20transformation%20to%20identify%20blood%20cells%20borderlines" target="_blank" rel="noopener noreferrer">Hough transformation to identify blood cells borderlines</a></li></ol></li><li><ol start="6"><li><a href="https://ngctnnnn.github.io/posts/computer-vision-for-leukocyte-prediction-2.html#:~:text=6.%20References" target="_blank" rel="noopener noreferrer">References</a></li></ol></li></ul></li></ul><hr><h4 id="_1-introduction" tabindex="-1">1. Introduction <a class="header-anchor" href="#_1-introduction" aria-hidden="true">#</a></h4><p>While blood cells (WBC), also known as <em>leukocytes</em>, are produced in the bone marrow and composed of nuclei and cytoplasm. WBCs are divided into five groups: basophil, eosinophil, lymphocyte, monocyte and neutrophil. Leukocytes protects the body against infectious disease and foreign substance, constitute an important part of the immune system. A healthy adult human consists of 4.1e9 to 11.1e9 of WBCs per a blood liter (or 4,500 to 11,000 WBCs per a blood microliter) and a drop in a blood consists of 7,000 to 25,000 WBCs. Any statistical number that outranges taken from an adult is considered as a disease.</p><div align="center"><table><thead><tr><th><p align="center"> Name</p></th><th><p align="center"> Description </p></th></tr></thead><tbody><tr><td><p align="center"> Neutrophils </p></td><td><p align="center"> Contact the microbial invasion, phagocytize and destroy invading organism </p></td></tr><tr><td><p align="center"> Eosinophils </p></td><td><p align="center"> Part of defense mechanism </p><p align="center">against parasitic infections, inflammatory processes and allergic tissue reactions </p></td></tr><tr><td><p align="center"> Basophils </p></td><td><p align="center"> Play role in allergic and immediate hypersensitivity reactions </p></td></tr><tr><td><p align="center"> Monocytes </p></td><td><p align="center"> Involve in defensive reactions to some microorganisms, remove damaged cells, cell debris</p><p align="center"> and armour bactericidal action as immune reaction </p></td></tr><tr><td><p align="center"> Lymphocytes </p></td><td><p align="center"> Produce antibodies and join in immune reactions </p></td></tr></tbody></table><p><b>Table 1. </b>Names and brief demonstration of normal leukocytes.</p></div><h4 id="_2-dataset-and-data-preprocessing" tabindex="-1">2. Dataset and data preprocessing <a class="header-anchor" href="#_2-dataset-and-data-preprocessing" aria-hidden="true">#</a></h4><p>The <a href="http://users.cecs.anu.edu.au/~hrezatofighi/Data/Leukocyte%20Data.htm" target="_blank" rel="noopener noreferrer">LISC - <em>Leukocyte Images for Segmentation and Classification</em></a> is used for automatic identification and blood cells counting since it is relatively easy to use.</p><blockquote><p>Samples were taken from peripheral blood of 8 normal subjects and 400 samples were obtained from 100 microscope slides. The microscope slides were smeared and stained by Gismo-Right technique and images were acquired by a light microscope (Microscope-Axioskope 40) from the stained peripheral blood using an achromatic lens with a magnification of 100. Then, these images were recorded by a digital camera and were saved in the BMP format. The images contain 720×576 pixels.</p></blockquote><blockquote><p>All of them are color images. The images were classified by a hematologist into normal leukocytes: basophil, eosinophil, lymphocyte, monocyte, and neutrophil. Also, the areas related to the nucleus and cytoplasm were manually segmented by an expert.</p></blockquote><p>You can download dataset here: <a href="http://users.cecs.anu.edu.au/~hrezatofighi/Data/Leukocyte%20Data.htm" target="_blank" rel="noopener noreferrer">LISC database</a>.</p><p>After that, images are transformed into gray scale using Python&#39;s <a href="https://pypi.org/project/opencv-python/" target="_blank" rel="noopener noreferrer">opencv</a> library:</p><div class="language-python"><pre><code><span class="token keyword">import</span> cv2
gray_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>original_img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
</code></pre></div><p>And after using opencv, we can change a normal leukocyte into a grayscale leukocyte.</p><div align="center" id="banner" style="display:flex;justify-content:space-between;"><div><img width="70%" src="https://github.com/BTrDung/Complex/raw/master/CreProjCBC/4.bmp" alt="leukocyte-before"></div><div><img width="40%" src="/grayscale-leukocyte.png" alt="leukocyte-after"></div></div><div align="center"><b>Fig 1.</b> Image of a normal leukocyte before and after using opencv </div><h4 id="_3-foreground-and-background-segmentation-technique" tabindex="-1">3. Foreground and background segmentation technique <a class="header-anchor" href="#_3-foreground-and-background-segmentation-technique" aria-hidden="true">#</a></h4><p>At the very first glance to the solution, we have to notice how to differentiate between foreground and background.</p><p>We could define foreground as an object that we want to observe detailedly. For a thorough understanding, a foregrounding object is the object we would like to separate from the whole picture for later purposes, e.g. object detecting or motion predicting. In this topic area, leukocytes and erythrocytes are defined as the foreground and moreover, we will not use background. Hence, at the end this section, we would guide you thoroughly to extract the foreground from the a whole picture.</p><p>Let make an overview about the image mentioned below:</p><p align="center"><img src="https://webpath.med.utah.edu/jpeg5/HEME005.jpg" alt="basophil"><div align="center"><figcaption><b>Fig 2.</b> Example of one blood cell photo from dataset </figcaption></div></p><p>Scientific evidence has it that dark purple areas are leukocytes and light purple areas are erythrocytes. We would divide the whole picture into 2 different ones: the first one only consists of leukocytes&#39; positions and the other consists of those from erythrocytes; and both of them would remain the original scale. The reason behind doing splitting thing is to make processing and classifying procedure more easily.</p><p>One of the most basic approach for this method is to use thresholding technique. The threshold formula could be expressed as below:</p><p><a href="https://www.codecogs.com/eqnedit.php?latex=\dpi{150}&amp;space;f(x,y)&amp;space;=&amp;space;\left\{\begin{matrix}&amp;space;255&amp;space;&amp;f(x,y)&amp;space;&gt;&amp;space;thres&amp;space;\\&amp;space;0&amp;space;&amp;f(x,y)\leq&amp;space;thres&amp;space;\end{matrix}\right." target="_blank"><img src="https://latex.codecogs.com/gif.latex?\dpi{150}&amp;space;f(x,y)&amp;space;=&amp;space;\left\{\begin{matrix}&amp;space;255&amp;space;&amp;f(x,y)&amp;space;&gt;&amp;space;\theta&amp;space;\\&amp;space;0&amp;space;&amp;f(x,y)\leq&amp;space;\theta&amp;space;\end{matrix}\right." title="f(x,y) = \left\{\begin{matrix} 255 &amp;f(x,y) &gt; \theta \\ 0 &amp;f(x,y)\leq thres \end{matrix}\right."></a> s.t. <em><strong>θ</strong></em> is defined as our threshold</p><p>Since our image has been already transformed from RGB to gray-scale, all pixels are now in the threshold of from 0 to 255. We could get rid of background part by using <a href="https://www.investopedia.com/terms/h/histogram.asp" target="_blank" rel="noopener noreferrer"><em>histogram</em></a>, which is the graph for representation of the distribution of colors in an image, to analyse and choose an appropriate threshold afterwards (i recommend you could take the chosen threshold from the number with the highest wave frequency).</p><p align="center"><img width="80%" src="/histogram.png" alt="histogram"><div align="center"><figcaption><b>Fig 3.</b> Histogram of Figure 1 (threshold = 255). </figcaption></div></p><p>After that, the area with pixels valuing in <code>f(x,y) &gt; threshold</code> are categorized as the foreground and vice versa is the background to identify the erythrocytes. In addition, we also apply another formula to extract leukocytes from the total image, which is:</p><p><a href="https://www.codecogs.com/eqnedit.php?latex=\inline&amp;space;\dpi{150}&amp;space;f(x,&amp;space;y)=\left\{\begin{matrix}&amp;space;255&amp;space;&amp;threshold_{min}&amp;space;\leq&amp;space;f(x,y)&amp;space;\leq&amp;space;threshold_{max}\\&amp;space;0&amp;space;&amp;f(x,&amp;space;y)&amp;space;\notin&amp;space;\[threshold_{min},threshold_{max}\]&amp;space;\end{matrix}\right." target="_blank"><img src="https://latex.codecogs.com/gif.latex?\inline&amp;space;\dpi{150}&amp;space;f(x,&amp;space;y)=\left\{\begin{matrix}&amp;space;255&amp;space;&amp;\theta_{min}&amp;space;\leq&amp;space;f(x,y)&amp;space;\leq&amp;space;\theta_{max}\\&amp;space;0&amp;space;&amp;f(x,&amp;space;y)&amp;space;\notin&amp;space;\[\theta_{min},\theta_{max}\]&amp;space;\end{matrix}\right." title="f(x, y)=\left\{\begin{matrix} 255 &amp;threshold_{min} \leq f(x,y) \leq threshold_{max}\\ 0 &amp;f(x, y) \notin \[threshold_{min},threshold_{max}\] \end{matrix}\right."></a></p><p>After using our proposed method, we would achieve the result as followed: <div align="center"><img width="50%" src="/grayscale-leukocyte.png" alt="grayscale leukocyte"><figcaption><b>Fig 4.</b> A grayscale cellular image to be processed</figcaption></div></p><div align="center" id="banner" style="display:flex;justify-content:space-between;"><div><p align="center"><img width="80%" src="/WBCs.png" alt="White blood cells image after using threshold"><div align="center"><figcaption><b>Fig 5.</b> Leukocytes after categorized as foreground </figcaption></div></p></div><div><p align="center"><img width="80%" src="/RBC.png" alt="Red blood cells image after using threshold"><div align="center"><figcaption><b>Fig 6.</b> Erythrocytes after categorized as foreground </figcaption></div></p></div></div><p>Our next blog would discuss further about how to detect and count blood cells in preprocessed images.</p></div></div></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 xl:col-start-1 xl:row-start-2"><div class="pt-8"><a class="link" href="/">← Back to the blog</a></div></footer></div><footer class="text-sm font-medium leading-5 divide-y divide-gray-200 xl:col-start-1 xl:row-start-2" style="display:inline-flex;justify-content:space-between;width:100%;"><div style="display:inline-flex;justify-content:space-between;width:100%;"><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500"> Previous Article </h2><div class="link"><a href="/posts/emotion-recognizing.html">← Real-time emotion recognizing</a></div></div><div class="py-8"><h2 class="text-xs tracking-wide uppercase text-gray-500"> Next Article </h2><div class="link"><a href="/posts/computer-vision-for-leukocyte-prediction-2.html">Leukocyte classification to predict diseases (Part 2) →</a></div></div></div></footer></article></main></div></div>
    
    
    
  </body>
</html>